"use strict";var y=Object.create;var o=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var P=(t,e)=>{for(var i in e)o(t,i,{get:e[i],enumerable:!0})},a=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of h(e))!D.call(t,s)&&s!==i&&o(t,s,{get:()=>e[s],enumerable:!(r=b(e,s))||r.enumerable});return t};var u=(t,e,i)=>(i=t!=null?y(O(t)):{},a(e||!t||!t.__esModule?o(i,"default",{value:t,enumerable:!0}):i,t)),k=t=>a(o({},"__esModule",{value:!0}),t);var x={};P(x,{default:()=>w,onPostBuild:()=>f});module.exports=k(x);var d=u(require("fs-extra")),m=u(require("path")),l=require("esbuild"),c=require("presta"),g=require("presta/utils/timer");var n={name:"@presta/adapter-node",version:"0.2.0",description:"Node adapter for Presta.",main:"dist/index.js",types:"dist/index.d.ts",files:["dist"],scripts:{build:"node scripts/build && tsc --emitDeclarationOnly",typecheck:"tsc --noEmit"},repository:{type:"git",url:"git+ssh://git@github.com/sure-thing/presta.git"},author:"estrattonbailey",license:"MIT",bugs:{url:"https://github.com/sure-thing/presta/issues"},homepage:"https://github.com/sure-thing/presta#readme",dependencies:{"@presta/utils":"workspace:^0.1.0",esbuild:"^0.14.11","fs-extra":"^10.1.0","mk-dirs":"^3.0.0",polka:"^1.0.0-next.22",presta:"workspace:^0.45.0",proxyquire:"^2.1.3",sirv:"^1.0.7"},devDependencies:{"@types/fs-extra":"^9.0.13","@types/node":"^18.6.3","lambda-types":"^1.0.0",typescript:"^4.7.4"}};var p=`${n.name}@${n.version}`;async function f(t,e){let i=t.getOutputDir(),r=m.default.join(i,"presta-node.js"),s={staticOutputDir:t.getStaticOutputDir(),functionsOutputDir:t.getFunctionsOutputDir(),manifest:t.getManifest()};d.default.outputFileSync(r,`import { adapter } from '@presta/adapter-node/dist/runtime';
export default adapter(${JSON.stringify(s)}, ${JSON.stringify(e)});`,"utf8"),await(0,l.build)({entryPoints:[r],outdir:i,platform:"node",target:["node12"],minify:!0,allowOverwrite:!0,format:"cjs"})}var w=(0,c.createPlugin)((t={})=>{let e=Object.assign({port:4e3},t);return function(r){return r.logger.debug(`${p} initialized`),r.events.on("buildComplete",async()=>{let s=(0,g.timer)();await f(r,e),r.logger.info(`${p} complete`,{duration:s()})}),{name:p}}});0&&(module.exports={onPostBuild});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vbGliL2luZGV4LnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgZnMgZnJvbSAnZnMtZXh0cmEnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IHsgYnVpbGQgYXMgZXNidWlsZCB9IGZyb20gJ2VzYnVpbGQnXG5pbXBvcnQgeyBjcmVhdGVQbHVnaW4sIFBsdWdpbkNvbnRleHQgfSBmcm9tICdwcmVzdGEnXG5pbXBvcnQgeyB0aW1lciB9IGZyb20gJ3ByZXN0YS91dGlscy90aW1lcidcblxuaW1wb3J0IHBrZyBmcm9tICcuLi9wYWNrYWdlLmpzb24nXG5pbXBvcnQgeyBPcHRpb25zIH0gZnJvbSAnLi90eXBlcydcblxuY29uc3QgUExVR0lOID0gYCR7cGtnLm5hbWV9QCR7cGtnLnZlcnNpb259YFxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gb25Qb3N0QnVpbGQoY3R4OiBQbHVnaW5Db250ZXh0LCBvcHRpb25zOiBPcHRpb25zKSB7XG4gIGNvbnN0IG91dHB1dERpciA9IGN0eC5nZXRPdXRwdXREaXIoKVxuICBjb25zdCBmaWxlcGF0aCA9IHBhdGguam9pbihvdXRwdXREaXIsICdwcmVzdGEtbm9kZS5qcycpXG4gIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgc3RhdGljT3V0cHV0RGlyOiBjdHguZ2V0U3RhdGljT3V0cHV0RGlyKCksXG4gICAgZnVuY3Rpb25zT3V0cHV0RGlyOiBjdHguZ2V0RnVuY3Rpb25zT3V0cHV0RGlyKCksXG4gICAgbWFuaWZlc3Q6IGN0eC5nZXRNYW5pZmVzdCgpLFxuICB9XG5cbiAgZnMub3V0cHV0RmlsZVN5bmMoXG4gICAgZmlsZXBhdGgsXG4gICAgYGltcG9ydCB7IGFkYXB0ZXIgfSBmcm9tICdAcHJlc3RhL2FkYXB0ZXItbm9kZS9kaXN0L3J1bnRpbWUnO1xuZXhwb3J0IGRlZmF1bHQgYWRhcHRlcigke0pTT04uc3RyaW5naWZ5KGNvbnRleHQpfSwgJHtKU09OLnN0cmluZ2lmeShvcHRpb25zKX0pO2AsXG4gICAgJ3V0ZjgnXG4gIClcblxuICBhd2FpdCBlc2J1aWxkKHtcbiAgICBlbnRyeVBvaW50czogW2ZpbGVwYXRoXSxcbiAgICBvdXRkaXI6IG91dHB1dERpcixcbiAgICBwbGF0Zm9ybTogJ25vZGUnLFxuICAgIHRhcmdldDogWydub2RlMTInXSxcbiAgICBtaW5pZnk6IHRydWUsXG4gICAgYWxsb3dPdmVyd3JpdGU6IHRydWUsIC8vIGl0IHdpbGwgYmUgb3ZlcndyaXR0ZW5cbiAgICBmb3JtYXQ6ICdjanMnLFxuICB9KVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVQbHVnaW4oKG9wdGlvbnM6IFBhcnRpYWw8T3B0aW9ucz4gPSB7fSkgPT4ge1xuICBjb25zdCBvcHRzID0gT2JqZWN0LmFzc2lnbih7IHBvcnQ6IDQwMDAgfSwgb3B0aW9ucylcblxuICByZXR1cm4gZnVuY3Rpb24gcGx1Z2luKGN0eCkge1xuICAgIGN0eC5sb2dnZXIuZGVidWcoYCR7UExVR0lOfSBpbml0aWFsaXplZGApXG5cbiAgICBjdHguZXZlbnRzLm9uKCdidWlsZENvbXBsZXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGltZSA9IHRpbWVyKClcbiAgICAgIC8qIGM4IGlnbm9yZSBzdGFydCAqL1xuICAgICAgYXdhaXQgb25Qb3N0QnVpbGQoY3R4LCBvcHRzKVxuXG4gICAgICBjdHgubG9nZ2VyLmluZm8oYCR7UExVR0lOfSBjb21wbGV0ZWAsIHsgZHVyYXRpb246IHRpbWUoKSB9KVxuICAgICAgLyogYzggaWdub3JlIHN0b3AgKi9cbiAgICB9KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IFBMVUdJTixcbiAgICB9XG4gIH1cbn0pXG4iXSwKICAibWFwcGluZ3MiOiAiMGpCQUFBLElBQUFBLEVBQUEsR0FBQUMsRUFBQUQsRUFBQSxhQUFBRSxFQUFBLGdCQUFBQyxJQUFBLGVBQUFDLEVBQUFKLEdBQUEsSUFBQUssRUFBZSx1QkFDZkMsRUFBaUIsbUJBQ2pCQyxFQUFpQyxtQkFDakNDLEVBQTRDLGtCQUM1Q0MsRUFBc0IsdXlCQUt0QixJQUFNQyxFQUFTLEdBQUdDLEVBQUksUUFBUUEsRUFBSSxVQUVsQyxlQUFzQkMsRUFBWUMsRUFBb0JDLEVBQWtCLENBQ3RFLElBQU1DLEVBQVlGLEVBQUksYUFBYSxFQUM3QkcsRUFBVyxFQUFBQyxRQUFLLEtBQUtGLEVBQVcsZ0JBQWdCLEVBQ2hERyxFQUFVLENBQ2QsZ0JBQWlCTCxFQUFJLG1CQUFtQixFQUN4QyxtQkFBb0JBLEVBQUksc0JBQXNCLEVBQzlDLFNBQVVBLEVBQUksWUFBWSxDQUM1QixFQUVBLEVBQUFNLFFBQUcsZUFDREgsRUFDQTtBQUFBLHlCQUNxQixLQUFLLFVBQVVFLENBQU8sTUFBTSxLQUFLLFVBQVVKLENBQU8sTUFDdkUsTUFDRixFQUVBLFFBQU0sRUFBQU0sT0FBUSxDQUNaLFlBQWEsQ0FBQ0osQ0FBUSxFQUN0QixPQUFRRCxFQUNSLFNBQVUsT0FDVixPQUFRLENBQUMsUUFBUSxFQUNqQixPQUFRLEdBQ1IsZUFBZ0IsR0FDaEIsT0FBUSxLQUNWLENBQUMsQ0FDSCxDQUVBLElBQU9NLEtBQVEsZ0JBQWEsQ0FBQ1AsRUFBNEIsQ0FBQyxJQUFNLENBQzlELElBQU1RLEVBQU8sT0FBTyxPQUFPLENBQUUsS0FBTSxHQUFLLEVBQUdSLENBQU8sRUFFbEQsT0FBTyxTQUFnQkQsRUFBSyxDQUMxQixPQUFBQSxFQUFJLE9BQU8sTUFBTSxHQUFHSCxlQUFvQixFQUV4Q0csRUFBSSxPQUFPLEdBQUcsZ0JBQWlCLFNBQVksQ0FDekMsSUFBTVUsS0FBTyxTQUFNLEVBRW5CLE1BQU1YLEVBQVlDLEVBQUtTLENBQUksRUFFM0JULEVBQUksT0FBTyxLQUFLLEdBQUdILGFBQW1CLENBQUUsU0FBVWEsRUFBSyxDQUFFLENBQUMsQ0FFNUQsQ0FBQyxFQUVNLENBQ0wsS0FBTWIsQ0FDUixDQUNGLENBQ0YsQ0FBQyIsCiAgIm5hbWVzIjogWyJsaWJfZXhwb3J0cyIsICJfX2V4cG9ydCIsICJsaWJfZGVmYXVsdCIsICJvblBvc3RCdWlsZCIsICJfX3RvQ29tbW9uSlMiLCAiaW1wb3J0X2ZzX2V4dHJhIiwgImltcG9ydF9wYXRoIiwgImltcG9ydF9lc2J1aWxkIiwgImltcG9ydF9wcmVzdGEiLCAiaW1wb3J0X3RpbWVyIiwgIlBMVUdJTiIsICJwYWNrYWdlX2RlZmF1bHQiLCAib25Qb3N0QnVpbGQiLCAiY3R4IiwgIm9wdGlvbnMiLCAib3V0cHV0RGlyIiwgImZpbGVwYXRoIiwgInBhdGgiLCAiY29udGV4dCIsICJmcyIsICJlc2J1aWxkIiwgImxpYl9kZWZhdWx0IiwgIm9wdHMiLCAidGltZSJdCn0K
